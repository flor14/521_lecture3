---
title: "DSCI 521 - Lecture 3"
subtitle: "Branches, forks, and streams... Welcome to the Git nature walk!"  
author: 
  - "MDS 2021/22"
output:
  xaringan::moon_reader:
    seal: false # saco filmina de inicio
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "https://platform.twitter.com/widgets.js"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
library(xaringanExtra)
library(tidyverse)
library(knitr)
library(nomnoml)
library(countdown)
xaringanExtra::use_logo(
  image_url = "https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/xaringan.png"
)
xaringanExtra::use_panelset()
xaringanExtra::use_broadcast()
xaringanExtra::use_share_again()
xaringanExtra::style_share_again(share_buttons = c("twitter", "linkedin"))
xaringanExtra::use_tachyons()
xaringanExtra::use_fit_screen()
xaringanExtra::use_tile_view() # O
style_mono_accent(
  base_color = "#0dc96f",
  background_color = "#ffffff",
  inverse_background_color = "#3298cb",
  header_color = "#022044",
  inverse_header_color = "#ffffff", 
  inverse_text_color = "#ffffff",
  code_inline_color = "#179c55",
  link_color= "#0000FF",
  text_font_size = "25px",
  header_font_google = google_font("Poppins", "Regular", "400"),
  text_font_google   = google_font("Darker Grotesque", "500"),
  code_font_google   = google_font("Fira Mono"),
  )

```

```{r metathis, warning=FALSE, echo=FALSE}
# library(metathis)
# meta() %>%
#   meta_name("github-repo" = "flor14/rladies-jujuy") %>% 
#   meta_social(
#     title = "Meetup R-Ladies Jujuy",
#     description = paste(
#       "Mi próximo artículo científico con R:", 
#       "Compendios de Investigación, Reproducibilidad e",
#       "Interactividad en las publicaciones académicas"
#     ),
#     url = "https://flor14.github.io/rladies-jujuy/presentacion.html?panelset=licencia#1",
#     image = "https://res.cloudinary.com/flor/image/upload/v1608248822/jujuy-colores_frmvax.jpg",
#     image_alt = paste(
#       "Charla para el capítulo de R-Ladies de Jujuy, Argentina.",
#       "Diciembre de 2020"
#       ),
#     og_type = "website",
#     og_author = "Florencia D'Andrea",
#     twitter_card_type = "summary_large_image",
#     twitter_creator = "@cantoflor_87",
#     twitter_site = "@cantoflor_87"
#   )
```




class: middle, center

```{r hex, fig.align='center', echo = FALSE, out.width=150} 
    knitr::include_graphics("img/hex.png")
```


---


class: bottom

.bg-washed-blue.b--dark-blue.ba.bw2.br3.shadow-5.ph4.mt5[
### DSCI 521 - Lecture 3
### **Branches, forks, and streams... Welcome to the Git nature walk!**

 .large[#### Computing Platforms for Data Science - UBC MDS 2021/22
]]


---

## Lecture 3

1 **Develop a feature on a branch** in a Git repo.

--

2. **Merge** the feature branch with the master branch.

--

3. Create a **fork** of an existing GitHub repo.

--

4. Open a **pull request** from your forked repo to the upstream repo


---


class: center, middle

```{r obj2, fig.align='center', echo = FALSE,out.width=900} 
knitr::include_graphics("img/obj2.png")
```


.footnote[[images: Unsplash](https://unsplash.com)]
---

git show or git diff or git log -p. para ver cambios

---

class: center, middle, inverse

# BRANCHES
separate work 

---

## Why to use them?

* You don't want the repository's default branch to be updated with every commit of a half-finished feature.

* When features are completed, their branches will be merged into the main branch, often through a "pull request" where code is reviewed before it is merged. 

```{r commits, fig.align='center', echo = FALSE,out.width=200} 
knitr::include_graphics("img/represent.png")
```


---


```{r obj4, fig.align='center', echo = FALSE,out.width=500} 
knitr::include_graphics("img/branches-house-analogy.png")
```


```{r house2, fig.align='center', echo = FALSE,out.width=500} 
knitr::include_graphics("img/house.jfif")
```

.footnote[[house image: Unsplash](https://unsplash.com)]

---

###

`HEAD -> main`

**main** is your default local branch

**HEAD** is where you currently (on the main branch)  



> You are on the main branch


---

###

`origin/main`

**origin** is a nickname for your remote repo on GitHub

**origin/main** is the main branch on your GitHub repo


> You Github repo is on the main branch

.footnote[_Note: In older repos `main` branch was called `master` branch_]
https://github.com/github/renaming
---

`origin/HEAD`

You don't need to care about origin/HEAD, it just point to the default remote branch, 
which will always be main unless you mess around with the settings on the GitHub webpage.

.footnote[_Note: In older repos `main` branch was called `master` branch_]

---


## Now all together

Now let's see what happens when we make a commit locally



---

class: center, inverse, middle

# How do we create a branch?



---


## Switch to a branch
#### `git switch`


##  Switch to a new branch
#### `git switch -c <name new branch>`
#### `git switch -c lecture-todo`


.footnote["It is good practice to give branches a name that succinctly describes the feature that you want to develop."]


---

# SEEING HOW BRANCHES ARE RELATED


---

## In the shell

* `git log` 
* `git log --oneline`
* `git log --oneline --all --graph`



---

## In VS Code

* `code .`

---

## 1. Working locally



---

## 2. Adding the remote



---

```{r 1, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/2.png")
```

---



class: inverse, center, middle
# FORKS

---

### How can I fork a repository?

Forks are copies of other's repositories on GitHub that you own.

```{r 2, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/2.png")
```




---

### How can I start developing in a forked repo

You clone the fork of YOUR repo, not the original repo


```{r 3, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/3.png")
```



> What happens if you have access to a repo? Can you fork it too?

---
class: center, middle
```{r 5, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/5.png")
```


---
class: center, middle
```{r 6, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/6.png")
```


---

class: middle, inverse, center

# DEVELOPING IN A FORKED REPO

---

### Work in a new local branch

It is good practice to always create a branch when you are about to add changes to a fork

```bash
git switch -c new-branch
```

```{r 7, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/7.png")
```



---


#### When to merge?
Good practice to have first pushed the branch to GitHub, and then created a pull request to let the other people on the team review the code and suggested any changes before merging it in.

```{r 8, fig.align='center', echo = FALSE,out.width=600} 
knitr::include_graphics("img/8.png")
```


When you are working on a branch you have to push your branch to GitHub and ask for it to be merged via a pull request. Since you don't have write access to the upstream repo, you have to request they the maintainer pull your code (remember that merging is part of what happens during a pull, so this is similar to what we did with branches via git merge, just that the code first needs to be fetched from your forked repo).

---

## Pushing to a new branch

```{r branch, fig.align='center', echo = FALSE,out.width=900} 
knitr::include_graphics("img/gitpush_newbranch.png")
```

.footnote[the word "upstream" is not referring to the GitHub branch you forked from. Instead, it is referring to a branch that will be created on your repo (origin).]



---

```bash
git push --set-upstream origin new-branch
```
```{r 81, fig.align='center', echo = FALSE,out.width=600} 
knitr::include_graphics("img/8.png")
```






---


class: inverse, center, middle

# CREATING A PULL REQUEST

---

To create PR, you click the green bottom "Compare and pull request".
"Create pull request".
Add reviewers if necessary
If they approved it the PR could be merged


```{r 9, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/9.png")
```



---

You can reference this pull request when typing Markdown in issues and other PRs on GitHub by typing # followed by the number of the PR, e.g. "Please see PR #2 for a fix to this issue". In the body of the message you type when opening the PR, you can also indicate if it is fixing a currently open issue by typing /close #1 to close issue number 1 (PRs and issues use the same numbering system, so if there is already an open issue, the first PR would be get the number 2).


---

class: inverse, center, middle

# KEEPING YOUR REMOTE (ORIGIN) UP TO DATE WITH THE UPSTREAM REMOTE 

---

### New commit in upstream remote

```{r 11, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/11.png")
```


---

### Fork again? 

```{r 12, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/12.png")
```

---


git remote -v

origin  https://github.ubc.ca/jostblom/fork-demo.git (fetch)
origin  https://github.ubc.ca/jostblom/fork-demo.git (push)

> Remember that pull = fetch + merge




---

### Add remote and pull


```bash
git remote add upstream https://github.ubc.ca/MDS-2021-22/fork-demo.git
git pull upstream master`
```


```{r 13, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/13.png")
```

---

### Push to origin

```bash
git push
```

```{r 14, fig.align='center', echo = FALSE,out.width=700} 
knitr::include_graphics("img/14.png")
```

origin  https://github.ubc.ca/jostblom/fork-demo.git (fetch)
origin  https://github.ubc.ca/jostblom/fork-demo.git (push)
upstream  https://github.ubc.ca/MDS-2020-21/fork-demo.git (fetch)
upstream  https://github.ubc.ca/MDS-2020-21/fork-demo.git (push)

> git pull, the default behavior is to pull the master branch from the origin remote (which in this case is your forked repo) 
> To pull the changes from upstream's master branch instead of origin's, we type git pull upstream master. 

To update our forked repo, we can now push as usually by typing git push, since the default behavior is git push origin master.

---




# Merging *

Merging in Git creates a special commit that has two unique parents. A commit with two parents essentially means "I want to include all the work from this parent over here and this one over here, and the set of all their parents."


